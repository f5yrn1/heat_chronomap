<!DOCTYPE html>
<html>
<head>
  <title>Chronomap Generator</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Chronomap Generator</h1>

<p>Enter your parameters and click Generate.  
This sends your inputs to a secure Cloudflare Worker, which updates
<code>inputs/latest.json</code> in the repository and triggers the GitHub Action.</p>

<label>Latitude:</label>
<input id="lat" type="text" value="50.067"><br><br>

<label>Longitude:</label>
<input id="lon" type="text" value="-112.097"><br><br>

<label>Year:</label>
<input id="year" type="text" value="2024"><br><br>

<label>Planting Date:</label>
<input id="planting" type="text" value="2024-05-20"><br><br>

<label>Harvest Date:</label>
<input id="harvest" type="text" value="2024-09-30"><br><br>

<button onclick="generate()">Generate Chronomap</button>

<h2>Latest Output</h2>
<p>The most recently generated chronomap will appear below:</p>

<img src="output/chronomap.png" width="900">

<script>
async function generate() {
  const data = {
    lat: parseFloat(document.getElementById("lat").value),
    lon: parseFloat(document.getElementById("lon").value),
    year: parseInt(document.getElementById("year").value),
    planting: document.getElementById("planting").value,
    harvest: document.getElementById("harvest").value
  };

  try {
    const resp = await fetch(
      "https://cold-pond-6408.jonathanarthurdonaldneilson.workers.dev/",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }
    );

    if (!resp.ok) {
      const text = await resp.text();
      alert("Worker error: " + text);
      return;
    }

    alert("Inputs updated. GitHub Action will run shortly.");
  } catch (err) {
    alert("Network error: " + err);
  }
}
</script>

</body>
</html>
